{{/* Codename for specific machine */}}
{{- $codename := "" -}}

{{/* 1Password vault to use */}}
{{- $vault := "" -}}

{{/* Machine does not have a screen and keyboard */}}
{{- $headless := false -}}

{{/* Machine is a client */}}
{{- $client := false -}}

{{/* More specific Linux distros */}}
{{- $osID := .chezmoi.os -}}
{{- if (and (eq .chezmoi.os "linux") (hasKey .chezmoi.osRelease "id")) -}}
{{-     $osID = printf "%s-%s" .chezmoi.os .chezmoi.osRelease.id -}}
{{- end -}}

{{/* Detect GitHub codespaces, VSCode remote containers, Docker containers,
Multipass VMs, and Vagrant boxes */}}
{{- $username := .chezmoi.username -}}
{{- if or
        (env "CODESPACES")
        (env "REMOTE_CONTAINERS_IPC")
        (eq $username "root" "ubuntu" "vagrant" "vscode")
-}}
{{-     $headless = true -}}
{{- else if stdinIsATTY -}}
{{-     $headless = promptBoolOnce . "headless" "headless" -}}
{{- else -}}
{{-     $headless = true -}}
{{- end -}}

{{- $hostname := .chezmoi.hostname -}}
{{/* Work around unreliable hostname on darwin */}}
{{- if eq .chezmoi.os "darwin" -}}
{{-     $computerName := output "scutil" "--get" "ComputerName" | trim -}}
{{-     $hostname := $computerName -}}
{{- end -}}

{{/* Resolve codename and 1Password vault */}}
{{- if hasPrefix "VNPC" $hostname -}}
{{-     $codename = "GFT" -}}
{{-     $vault = "GFT" -}}
{{-     $client = true -}}
{{- else if eq $hostname "T-X" }}
{{-     $codename = "T-X" -}}
{{-     $vault = "Personal" -}}
{{- else if eq $hostname "Arwen" }}
{{-     $codename = "Arwen" -}}
{{-     $vault = "Personal" -}}
{{- else if eq $hostname "Madison" }}
{{-     $codename = "Madison" -}}
{{-     $vault = "Personal" -}}
{{-     $client = true -}}
{{- end -}}

umask = 0o77

sourceDir = "~/Documents/Projects/Personal/dotfiles"

[data]
    codename = {{ $codename | quote }}
    vault = {{ $vault | quote }}
    headless = {{ $headless }}
    osid = {{ $osID | quote }}
    client = {{ $client | quote }}

[diff]
    exclude = ["scripts"]

[status]
    exclude = ["scripts"]

[scriptEnv]
    PATH = """\
        /opt/homebrew/bin:\
        /usr/local/bin:\
        /home/linuxbrew/.linuxbrew/bin:\
        {{ env "PATH" }}\
    """
    CHEZMOI_OSID = {{ $osID | quote }}

[interpreters.ps1]
    command = "powershell"
    args = ["-NoLogo", "-NoProfile", "-ExecutionPolicy", "Bypass"]
